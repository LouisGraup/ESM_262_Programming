---
title: 'Control Structures'
author: "Naomi Tague"
date: "January, 2021"
output:
  slidy_presentation:
   highlight: pygments
  html_document: default
  pdf_document: default
  ioslides_presentation:
    highlight: pygments
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo =TRUE)
knitr::opts_chunk$set(error=TRUE)
#knitr::opts_knit$set(root.dir = '/Users/naomitague/CoursesLocal/ESM262n/docs/dataf2')
library(tidyverse)
library(purrr)
```

# Flow Control (think of steering your program)

Another KEY concept is flow control
In your function you do different things depending on a conditions

CLASSIC example is 

IF then ELSE

If you have multiple conditions we can use case_when
Here's a silly simple example of how it works

```{r}

# if x is 1, return A, if x is 2, return, B, if x is 3, return, C

x=1
case_when(x ==1 ~ "A", x==2 ~ "B", x >= 3 ~ "C")

x = c(1,2,1,3)
case_when(x ==1 ~ "A", x==2 ~ "B", x==3 ~ "C")
```

# A more interesting example

Lets imagine that we are monitoring pollution in a lake, and we want to write a function that will let us know (flag) a nutrient pollution as high, medium or low

Risk is high if water temperature is greater than a threshold for more than 5 days, 
and mean nutrient concentration is greater than a high threshold

Risk is medium if water temperature is greater than a threshold for more than 5 days
and mean nutrient concentration is greater than a medium threshold


Inputs:   
nutrient concentration for at least 5 days
temperature for at least 5 days
thresholds for temperature and nutrient (with default values)

Output:
Pollution Risk as "low", "med" or "high"

Take a look at classify_lake 
* example of while
* example of flow control with if..else   and case_when

```{r}

source("R/classify_lake.R")

# generate some data to try the function
temperature = runif(min=4, max=35, n=30)
nutrient = runif(min=5, max=40, n=30)

# try it
classify_lake(temperature=temperature, nutrient=nutrient)

# lets pick some numbers we know should give us a low value
nutrient = runif(min=0, max=5, n=30)
classify_lake(temperature=temperature, nutrient=nutrient)

# now try high
# use repeat to generate the same value multiple times
nutrient = rep(50, times=30)
temperature = rep(25, times=30)
classify_lake(temperature=temperature, nutrient=nutrient)
```



# What we've learned

* how to write a function (and add error checking)
* how to generate data
* how to repeat in code  (different types of looping)
* how to "nest" functions
* how to make choices (flow control)

# Repeating 

in most  R functions, if all variables have one or the *same* number of values, iteration happens automatically BUT this always depends on how you define your function


For example:

# Generating Data for your function
```{r}

mycortest  = function(x,y, thresh=0.8) {
  # compute correlation
  res = cor(x,y)
  classification = ifelse(res > thresh, "GOOD", "NotGood")
  return(classification)
}

a = runif(min=1, max=100, n=100)
b = runif(min=1, max=100, n=100)

mycortest(a,b)
mycortest(a,a)
# this doesn't work
mycortest(a, 1)

# useful to add error checking
mycortest  = function(x,y, thresh=0.8) {
  # compute correlation
  if(length(x) != length(y)) {return("unequal lengths for x and y")}
  res = cor(x,y)
  classification = ifelse(res > thresh, "GOOD", "NotGood")
  return(classification)
}
mycortest(a, 1)

```

# Assignment for today

Make up a function that includes flow control (if statement) and has inputs and parameters (more than two ) that you can vary
Here we want to practice designing functions, using flow control, ways of generating data and running functions across ranges of different inputs - and of course visualizing results 


Write that function, save it in a .R file

In an Rmarkdown document, generate some data to experiment with your function, create scenario where you repeat the function for each row in a data set (you can use this for inputs and/or parameters) - Similar to what we did for the autopower function when we ran it for multiple speeds (but you could do something over time, multiple climate inputs, multiple ages...depending on your function of course)

Then generate a scenario where you repeat what you just did (for all rows) where you vary another a parameter using pmap (or a loop) - Similar to what we did when we  ran our autopower function for different cars and speeds - and then repeated the cars/speed scenarios for different drag coefficients

Make sure you use good programming practices
* provide details on the function contract at the top of the function - what are inputs/output their units format etc
* understandable variables names
* commenting through out so its easy to understand what you are doing
* add error checking

# Review for next class

* DataTypes.Rmd
* compute_simpson_index.R
* computediversity.R
